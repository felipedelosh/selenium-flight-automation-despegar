(function(root){ var webNotificationConfig = { locale: 'es_CO', country: 'CO', language: 'es', baseUrl: '//www.despegar.com.co/me/subscriptions-ui', company: '1', vapidPublicKey : 'BLbwDxff7Sz7_w1VlaTeCILNfGrV3Uqb19RU7IGcecGJ53-S4Pm3FzvPMmCKJKv4yEDu85cAWZ_96kFryyd2SBU=' }; "use strict";!function(n){var i=function(){var n=webNotificationConfig.vapidPublicKey,r=webNotificationConfig.company,t=void 0,s=void 0;function c(){return new Promise(function(e,i){s?e(s):navigator.serviceWorker.register(webNotificationConfig.baseUrl+"/staticui/libs/service-worker.js").then(function(n){n.update(),e(n)}).catch(function(n){console.log("ServiceWorker registration failed: ",n),i("ServiceWorker registration failed")})})}function u(n,e){return fetch(n,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json",Cache:"no-cache"},body:JSON.stringify(e)}).then(function(n){if(!n.ok)throw new Error("SERVICE_ERROR");return n.json()}).then(function(n){return n.browser_id})}function i(n,e){"undefined"!=typeof dataLayer&&setTimeout(function(){dataLayer.push({event:"user-action",eventCategory:"Web Notification",eventAction:n,eventLabel:e,eventValue:0})},0)}return{init:function(){"serviceWorker"in navigator&&"PushManager"in window&&(t={userVisibleOnly:!0,applicationServerKey:function(n){for(var e=(n+"=".repeat((4-n.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(e),t=new Uint8Array(i.length),o=0;o<i.length;++o)t[o]=i.charCodeAt(o);return t}(n)},c().then(function(n){s=n},function(n){console.log(n)}))},askPermissionAndSubscribe:function(o,n){return new Promise(function(e,n){c().then(function(n){i("ask_permission",o),e(new Promise(function(e,n){var i=Notification.requestPermission(function(n){e(n)});i&&i.then(e,n)}))},function(){n("WEB_NOTIFICATION_UNAVAILABLE")})}).then(function(n){if("granted"!==n)throw i("permission_denied",o),new Error("PERMISSION_DENIED");return i("permission_granted",o),s.pushManager.subscribe(t).then(function(n){return n})}).then(function(n){return e=n,i=o,t=JSON.stringify(e),(t=JSON.parse(t)).origin=i,t.company_id=r,t.country=window.ShifuConfig._country,u(webNotificationConfig.baseUrl+"/api/webNotifications",t);var e,i,t})},checkPushSupport:function(){return"serviceWorker"in navigator&&"PushManager"in window},permissionStatus:function(){return Notification.permission},getBrowserId:function(){return new Promise(function(e,n){c().then(function(n){e(n.pushManager.getSubscription(t).then(function(n){if(!n||!n.endpoint)throw new Error("BROWSER_NOT_SUBSCRIBED");return e=n.endpoint,u(webNotificationConfig.baseUrl+"/api/browser",{endpoint:e});var e}))},function(){n("WEB_NOTIFICATION_UNAVAILABLE")})})},unsubscribeBrowser:function(i){return new Promise(function(e,n){c().then(function(n){e(n.pushManager.getSubscription(t).then(function(n){if(!n||!n.endpoint)throw new Error("BROWSER_NOT_SUBSCRIBED");n.unsubscribe().then(function(n){var e;e=i,fetch(webNotificationConfig.baseUrl+"/api/browser?tracker_id="+e,{method:"DELETE",credentials:"same-origin",headers:{Cache:"no-cache"}}).then(function(n){if(!n.ok)throw new Error("SERVICE_ERROR")})}).catch(function(n){throw new Error("BROWSER_NOT_SUBSCRIBED")})}))},function(){n("WEB_NOTIFICATION_UNAVAILABLE")})})}}}();"1"===webNotificationConfig.company?(void 0===n.DespegarWebNotifications&&("undefined"==typeof global||"undefined"!=typeof global&&void 0===global.DespegarWebNotifications)&&(n.DespegarWebNotifications=function(){i.checkPushSupport()&&i.init();return{askPermissionAndSubscribe:function(n,e){return i.askPermissionAndSubscribe(n,e)},permissionStatus:function(){return i.permissionStatus()},isWebNotificationsAvailable:function(){return i.checkPushSupport()},getBrowserId:function(){return i.getBrowserId()},unsubscribeBrowser:function(n){return i.unsubscribeBrowser(n)}}}()),"undefined"!=typeof global&&(global.DespegarWebNotifications=n.DespegarWebNotifications)):(void 0===n.GenericWebNotifications&&("undefined"==typeof global||"undefined"!=typeof global&&void 0===global.GenericWebNotifications)&&(n.GenericWebNotifications=function(){i.checkPushSupport()&&i.init();return{askPermissionAndSubscribe:function(n,e){return i.askPermissionAndSubscribe(n,e)},permissionStatus:function(){return i.permissionStatus()},isWebNotificationsAvailable:function(){return i.checkPushSupport()},getBrowserId:function(){return i.getBrowserId()},unsubscribeBrowser:function(n){return i.unsubscribeBrowser(n)}}}()),"undefined"!=typeof global&&(global.GenericWebNotifications=n.GenericWebNotifications))}(window); })(this);